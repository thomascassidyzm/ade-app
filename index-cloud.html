<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Multi-Agent Coordination System - Cloud</title>
    <script src="https://js.pusher.com/7.2/pusher.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            grid-template-rows: 60px 1fr;
            height: 100vh;
            gap: 1px;
            background: #1a1a1a;
        }
        
        .header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 20px;
        }
        
        .header h1 {
            font-size: 1.25rem;
            font-weight: 600;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .sidebar {
            background: #151515;
            border-right: 1px solid #333;
            overflow-y: auto;
        }
        
        .agent-list {
            padding: 1rem;
        }
        
        .agent-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: #1e1e1e;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        
        .agent-item:hover {
            background: #252525;
            border-color: #444;
        }
        
        .agent-item.active {
            background: #2a2a3e;
            border-color: #60a5fa;
        }
        
        .agent-name {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .agent-status {
            font-size: 0.75rem;
            color: #888;
        }
        
        .main-content {
            background: #0f0f0f;
            display: flex;
            flex-direction: column;
        }
        
        .message-area {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            background: #1a1a1a;
            border-radius: 8px;
            border-left: 3px solid #333;
        }
        
        .message.from-agent {
            border-left-color: #60a5fa;
        }
        
        .message.to-agent {
            border-left-color: #a78bfa;
        }
        
        .message.broadcast {
            border-left-color: #f59e0b;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .message-from {
            color: #60a5fa;
        }
        
        .message-to {
            color: #a78bfa;
        }
        
        .message-time {
            color: #666;
        }
        
        .message-content {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.875rem;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        
        .input-area {
            padding: 1rem;
            background: #1a1a1a;
            border-top: 1px solid #333;
        }
        
        .input-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .input-controls select, .input-controls input {
            background: #0f0f0f;
            border: 1px solid #333;
            color: #e0e0e0;
            padding: 0.5rem;
            border-radius: 4px;
        }
        
        .message-input {
            width: 100%;
            min-height: 80px;
            background: #0f0f0f;
            border: 1px solid #333;
            color: #e0e0e0;
            padding: 0.75rem;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.875rem;
            resize: vertical;
        }
        
        .send-button {
            margin-top: 0.5rem;
            padding: 0.5rem 1.5rem;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: opacity 0.2s;
        }
        
        .send-button:hover {
            opacity: 0.9;
        }
        
        .activity-panel {
            background: #151515;
            border-left: 1px solid #333;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .activity-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: #1e1e1e;
            border-radius: 6px;
            font-size: 0.75rem;
        }
        
        .activity-type {
            font-weight: 500;
            margin-bottom: 4px;
            color: #60a5fa;
        }
        
        .activity-detail {
            color: #888;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #252525;
            border-radius: 4px;
            margin-top: 0.5rem;
            cursor: pointer;
        }
        
        .file-icon {
            width: 16px;
            height: 16px;
            opacity: 0.6;
        }
        
        .file-name {
            flex: 1;
            font-size: 0.75rem;
            color: #aaa;
        }
        
        .setup-notice {
            grid-column: 1 / -1;
            background: #1e293b;
            border: 1px solid #3b82f6;
            padding: 1rem;
            margin: 1rem;
            border-radius: 8px;
        }
        
        .setup-notice h3 {
            color: #60a5fa;
            margin-bottom: 0.5rem;
        }
        
        .setup-notice code {
            background: #0f172a;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="app-container">
            <div class="header">
                <h1>Claude Multi-Agent Coordination System</h1>
                <div class="status-indicator">
                    <div class="status-dot" :style="{background: connected ? '#10b981' : '#ef4444'}"></div>
                    <span>{{ connected ? 'Connected' : 'Disconnected' }}</span>
                </div>
            </div>
            
            <div v-if="!configured" class="setup-notice">
                <h3>Setup Required</h3>
                <p>To use this system, you need to:</p>
                <ol>
                    <li>Deploy to Vercel: <code>vercel deploy</code></li>
                    <li>Set up Vercel KV for data storage</li>
                    <li>Set up Pusher for real-time updates</li>
                    <li>Add environment variables in Vercel dashboard</li>
                </ol>
            </div>
            
            <div class="sidebar">
                <div class="agent-list">
                    <h3 style="margin-bottom: 1rem; color: #888;">Connected Agents</h3>
                    <div 
                        v-for="agent in agents" 
                        :key="agent.id"
                        :class="['agent-item', { active: selectedAgent === agent.id }]"
                        @click="selectAgent(agent.id)"
                    >
                        <div class="agent-name">{{ agent.name }}</div>
                        <div class="agent-status">{{ agent.capabilities.join(', ') }}</div>
                    </div>
                </div>
            </div>
            
            <div class="main-content">
                <div class="message-area" ref="messageArea">
                    <div 
                        v-for="message in messages" 
                        :key="message.id"
                        :class="['message', getMessageClass(message)]"
                    >
                        <div class="message-header">
                            <div>
                                <span class="message-from">{{ message.from }}</span>
                                <span v-if="message.to"> â†’ </span>
                                <span v-if="message.to" class="message-to">{{ message.to }}</span>
                                <span v-else class="message-to">[Broadcast]</span>
                            </div>
                            <span class="message-time">{{ formatTime(message.timestamp) }}</span>
                        </div>
                        <div class="message-content">{{ message.content }}</div>
                    </div>
                </div>
                
                <div class="input-area">
                    <div class="input-controls">
                        <select v-model="messageTarget">
                            <option value="">Broadcast to all</option>
                            <option v-for="agent in agents" :key="agent.id" :value="agent.id">
                                {{ agent.name }}
                            </option>
                        </select>
                        <input v-model="messageType" placeholder="Message type (optional)">
                    </div>
                    <textarea 
                        v-model="messageContent" 
                        class="message-input"
                        placeholder="Type your message..."
                        @keydown.enter.meta="sendMessage"
                    ></textarea>
                    <button @click="sendMessage" class="send-button">Send Message</button>
                </div>
            </div>
            
            <div class="activity-panel">
                <h3 style="margin-bottom: 1rem; color: #888;">Files</h3>
                <div v-for="file in files" :key="file.id" class="activity-item">
                    <div class="activity-type">{{ file.filename }}</div>
                    <div class="activity-detail">by {{ file.agentId }}</div>
                    <div class="file-item" @click="openFile(file)">
                        <svg class="file-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 1 1 0 000 2H6a2 2 0 00-2 2v6a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-1a1 1 0 100-2h1a4 4 0 014 4v6a4 4 0 01-4 4H6a4 4 0 01-4-4V7a4 4 0 014-4z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="file-name">View File</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, nextTick } = Vue;
        
        // Get API URL from current location or use environment variable
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api' 
            : '/api';
        
        createApp({
            setup() {
                const agents = ref([]);
                const messages = ref([]);
                const files = ref([]);
                const selectedAgent = ref(null);
                const messageContent = ref('');
                const messageTarget = ref('');
                const messageType = ref('');
                const messageArea = ref(null);
                const connected = ref(false);
                const configured = ref(true); // Set to false if not configured
                const pusher = ref(null);
                
                function getMessageClass(message) {
                    if (!message.to) return 'broadcast';
                    if (message.from === 'coordinator') return 'to-agent';
                    return 'from-agent';
                }
                
                function formatTime(timestamp) {
                    return new Date(timestamp).toLocaleTimeString();
                }
                
                function selectAgent(agentId) {
                    selectedAgent.value = agentId;
                }
                
                async function sendMessage() {
                    if (!messageContent.value.trim()) return;
                    
                    try {
                        const response = await fetch(`${API_URL}/messages`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                from: 'coordinator',
                                to: messageTarget.value || null,
                                type: messageType.value || 'text',
                                content: messageContent.value
                            })
                        });
                        
                        if (response.ok) {
                            messageContent.value = '';
                        }
                    } catch (error) {
                        console.error('Failed to send message:', error);
                    }
                }
                
                async function loadMessages() {
                    try {
                        const response = await fetch(`${API_URL}/messages?limit=50`);
                        const data = await response.json();
                        messages.value = data.messages.reverse();
                    } catch (error) {
                        console.error('Failed to load messages:', error);
                    }
                }
                
                async function loadFiles() {
                    try {
                        const response = await fetch(`${API_URL}/files?limit=20`);
                        const data = await response.json();
                        files.value = data.files;
                    } catch (error) {
                        console.error('Failed to load files:', error);
                    }
                }
                
                async function loadAgents() {
                    try {
                        const response = await fetch(`${API_URL}/agents`);
                        const data = await response.json();
                        agents.value = data.agents || [];
                    } catch (error) {
                        console.error('Failed to load agents:', error);
                    }
                }
                
                function openFile(file) {
                    // Get file details and open in new tab
                    fetch(`${API_URL}/files?id=${file.id}`)
                        .then(res => res.json())
                        .then(data => {
                            if (data.url) {
                                window.open(data.url, '_blank');
                            }
                        });
                }
                
                function initializePusher() {
                    // Initialize Pusher for real-time updates
                    // You'll need to add your Pusher key here
                    const PUSHER_KEY = 'YOUR_PUSHER_KEY';
                    
                    if (PUSHER_KEY === 'YOUR_PUSHER_KEY') {
                        console.log('Pusher not configured - real-time updates disabled');
                        return;
                    }
                    
                    pusher.value = new Pusher(PUSHER_KEY, {
                        cluster: 'us2'
                    });
                    
                    const channel = pusher.value.subscribe('agent-coordination');
                    
                    channel.bind('new-message', (data) => {
                        messages.value.push(data);
                        scrollToBottom();
                    });
                    
                    channel.bind('agent-joined', (data) => {
                        agents.value.push(data);
                    });
                    
                    channel.bind('file-created', (data) => {
                        files.value.unshift(data);
                    });
                    
                    channel.bind('connected', () => {
                        connected.value = true;
                    });
                }
                
                async function scrollToBottom() {
                    await nextTick();
                    if (messageArea.value) {
                        messageArea.value.scrollTop = messageArea.value.scrollHeight;
                    }
                }
                
                onMounted(() => {
                    loadMessages();
                    loadFiles();
                    loadAgents();
                    initializePusher();
                    
                    // Refresh periodically if Pusher not available
                    setInterval(() => {
                        if (!pusher.value) {
                            loadMessages();
                            loadFiles();
                            loadAgents();
                        }
                    }, 5000);
                });
                
                return {
                    agents,
                    messages,
                    files,
                    selectedAgent,
                    messageContent,
                    messageTarget,
                    messageType,
                    messageArea,
                    connected,
                    configured,
                    getMessageClass,
                    formatTime,
                    selectAgent,
                    sendMessage,
                    openFile
                };
            }
        }).mount('#app');
    </script>
</body>
</html>